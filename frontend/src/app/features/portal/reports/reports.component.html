<section class="container mt-4">
  <h2 class="text-primary fw-bold mb-4">Relatórios de Equipamentos</h2>

  <form [formGroup]="reportForm" (ngSubmit)="generateReport()" class="row g-3 mb-4">
    <div class="col-md-3">
      <label>Status:</label>
      <select formControlName="status" class="form-select">
        <option value="">Todos</option>
        <option value="PENDENTE">Pendente</option>
        <option value="APROVADO">Aprovado</option>
        <option value="REPROVADO">Reprovado</option>
      </select>
    </div>

    <div class="col-md-3">
      <label>Responsável:</label>
      <input formControlName="responsavel" class="form-control" placeholder="Digite o nome" />
    </div>

    <div class="col-md-2">
      <label>Data Inicial:</label>
      <input type="date" formControlName="startDate" class="form-control" />
    </div>

    <div class="col-md-2">
      <label>Data Final:</label>
      <input type="date" formControlName="endDate" class="form-control" />
    </div>

    <div class="col-md-2 d-flex align-items-end">
      <button type="submit" class="btn btn-primary w-100">
        <i class="bi bi-search"></i> Gerar
      </button>
    </div>
  </form>

  <div *ngIf="loading" class="text-center mt-4">
    <div class="spinner-border text-primary"></div>
    <p>Gerando relatório...</p>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <div *ngIf="!loading && equipamentos.length > 0">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <p class="text-muted">Total: {{ total }} equipamentos encontrados</p>
      <button class="btn btn-outline-success btn-sm" (click)="exportToCSV()">
        <i class="bi bi-filetype-csv"></i> Exportar CSV
      </button>
    </div>

    <div class="table-responsive shadow-sm rounded">
      <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
          <tr>
            <th>Código</th>
            <th>Posto</th>
            <th>Razão</th>
            <th>Versão</th>
            <th>Descrição</th>
            <th>Data Limite</th>
            <th>Responsável</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let eq of equipamentos">
            <td>{{ eq.codigo }}</td>
            <td>{{ eq.nome_do_posto }}</td>
            <td>{{ eq.razao_uso }}</td>
            <td>{{ eq.versao_solucao }}</td>
            <td>{{ eq.descricao }}</td>
            <td>{{ eq.data_limite | date: 'dd/MM/yyyy' }}</td>
            <td>{{ eq.responsavel }}</td>
            <td>
              <span class="badge"
                [ngClass]="{
                  'bg-success': eq.status === 'APROVADO',
                  'bg-warning text-dark': eq.status === 'PENDENTE',
                  'bg-danger': eq.status === 'REPROVADO'
                }">
                {{ eq.status }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div *ngIf="!loading && equipamentos.length === 0 && !errorMessage" class="alert alert-info text-center mt-4">
    Nenhum equipamento encontrado para os filtros aplicados.
  </div>
</section>
