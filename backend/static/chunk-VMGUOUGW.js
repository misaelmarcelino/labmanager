import{a as A,c as L,d as W,f as N,h as q,i as j,o as D,p as B,q as z}from"./chunk-YFECTA2Y.js";import{a as G}from"./chunk-YJEBKNWG.js";import{b as F,d as k,e as E}from"./chunk-CMUAIOSF.js";import{$a as V,Ab as I,C as v,Eb as T,Ha as p,Ja as m,La as i,Ma as r,Na as M,Qa as C,Ra as x,Sa as h,Ta as R,Ua as o,Wa as b,Xa as f,Y as S,Ya as w,Za as P,ea as c,fa as u,ta as n,ua as g}from"./chunk-LOHWPVPR.js";function O(s,_){if(s&1&&(i(0,"div",20),o(1),r()),s&2){let t=h();n(),b(" ",t.errorMessage," ")}}function H(s,_){if(s&1&&(i(0,"div",21),o(1),r()),s&2){let t=h();n(),b(" ",t.successMessage," ")}}function J(s,_){if(s&1){let t=C();i(0,"div",10)(1,"label",22),o(2,"Senha atual:"),r(),i(3,"input",23),P("ngModelChange",function(e){c(t);let a=h();return w(a.oldPassword,e)||(a.oldPassword=e),u(e)}),r()()}if(s&2){let t=h();n(3),f("ngModel",t.oldPassword)}}function K(s,_){s&1&&M(0,"span",24)}var ie=(()=>{class s{constructor(t,d,e){this.auth=t,this.route=d,this.router=e,this.email="",this.oldPassword="",this.newPassword="",this.confirmPassword="",this.loading=!1,this.errorMessage=null,this.successMessage=null,this.isFirstAccess=!1,this.token=null}ngOnInit(){this.route.queryParams.subscribe(t=>{this.token=t.token??null,this.isFirstAccess=t.first==="true",this.email=t.email??""})}submit(){if(this.resetMessages(),!!this.isPasswordValid()){if(this.loading=!0,this.isFirstAccess){this.handleFirstAccess();return}this.handleTokenReset()}}handleFirstAccess(){if(!this.email){this.errorMessage="Email inv\xE1lido ou ausente.",this.loading=!1;return}if(!this.oldPassword){this.errorMessage="Informe sua senha atual.",this.loading=!1;return}this.auth.firstAccess(this.email,this.oldPassword,this.newPassword).pipe(v(()=>this.loading=!1)).subscribe({next:()=>{this.successMessage="Senha definida com sucesso! Fa\xE7a login.",this.redirectToLogin()},error:t=>{this.errorMessage=t.error?.detail||"Senha atual incorreta."}})}handleTokenReset(){if(!this.token){this.errorMessage="Token inv\xE1lido ou ausente.",this.loading=!1;return}this.auth.resetPassword(this.token,this.newPassword).pipe(v(()=>this.loading=!1)).subscribe({next:()=>{this.successMessage="Senha redefinida com sucesso! Fa\xE7a login.",this.redirectToLogin()},error:t=>{this.errorMessage=t.error?.detail||"Erro ao redefinir senha."}})}isPasswordValid(){return!this.newPassword||!this.confirmPassword?(this.errorMessage="Preencha todos os campos.",!1):this.newPassword!==this.confirmPassword?(this.errorMessage="As senhas n\xE3o conferem.",!1):!0}resetMessages(){this.errorMessage=null,this.successMessage=null}redirectToLogin(){setTimeout(()=>{this.router.navigate(["/login"])},2e3)}static{this.\u0275fac=function(d){return new(d||s)(g(G),g(F),g(k))}}static{this.\u0275cmp=S({type:s,selectors:[["app-reset-password"]],standalone:!0,features:[V],decls:26,vars:7,consts:[["resetForm","ngForm"],[1,"reset-password","container","d-flex","justify-content-center","align-items-center","vh-100"],[1,"card","shadow","p-4",2,"max-width","400px","width","100%"],[1,"text-center","w-100"],["src","/assets/images/logo-painel.png","alt","Logo","height","60"],[1,"text-center","mt-4"],["class","alert alert-danger",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["novalidate",""],["class","mb-3",4,"ngIf"],[1,"mb-3"],["for","newPassword",1,"form-label"],["type","password","id","newPassword","name","newPassword","placeholder","Digite sua nova senha","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","name","confirmPassword","placeholder","Repita sua nova senha","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-grid"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"mt-3","text-center"],["routerLink","/login",1,"text-decoration-none"],[1,"alert","alert-danger"],[1,"alert","alert-success"],["for","oldPassword",1,"form-label"],["type","password","id","oldPassword","name","oldPassword","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(d,e){if(d&1){let a=C();i(0,"div",1)(1,"div",2)(2,"div",3),M(3,"img",4),i(4,"h2",5),o(5,"Redefina sua Senha:"),r()(),p(6,O,2,1,"div",6)(7,H,2,1,"div",7),i(8,"form",8,0),p(10,J,4,1,"div",9),i(11,"div",10)(12,"label",11),o(13,"Nova senha:"),r(),i(14,"input",12),P("ngModelChange",function(l){return c(a),w(e.newPassword,l)||(e.newPassword=l),u(l)}),r()(),i(15,"div",10)(16,"label",13),o(17,"Confirme nova senha:"),r(),i(18,"input",14),P("ngModelChange",function(l){return c(a),w(e.confirmPassword,l)||(e.confirmPassword=l),u(l)}),r()(),i(19,"div",15)(20,"button",16),x("click",function(){return c(a),u(e.submit())}),p(21,K,1,0,"span",17),o(22," Redefinir senha "),r()()(),i(23,"div",18)(24,"a",19),o(25,"Voltar ao login"),r()()()()}if(d&2){let a=R(9);n(6),m("ngIf",e.errorMessage),n(),m("ngIf",e.successMessage),n(3),m("ngIf",e.isFirstAccess),n(4),f("ngModel",e.newPassword),n(4),f("ngModel",e.confirmPassword),n(2),m("disabled",a.invalid||e.loading||e.newPassword!==e.confirmPassword),n(),m("ngIf",e.loading)}},dependencies:[T,I,z,j,A,L,W,D,B,q,N,E]})}}return s})();export{ie as ResetPasswordComponent};
