import{a as H}from"./chunk-6E4SWIPS.js";import{a as T,c as q,d as A,e as j,g,i as k,j as G,k as L,l as z,m as U,n as B,r as $}from"./chunk-LJR2HZOE.js";import{k as M,l as N,m as P,p as f,q as V}from"./chunk-K6RXEC2N.js";import{$a as p,La as S,Na as d,Pa as i,Qa as e,Ra as u,Ua as y,Xa as b,Ya as x,_ as h,_a as n,ab as E,eb as w,fb as R,gb as F,ha as C,hb as I,ia as D,ib as O,wa as a,xa as _}from"./chunk-TBSY5OFZ.js";var J=(r,c,t)=>({"bg-success":r,"bg-warning text-dark":c,"bg-danger":t});function K(r,c){r&1&&(i(0,"div",20),u(1,"div",21),i(2,"p"),n(3,"Gerando relat\xF3rio..."),e()())}function Q(r,c){if(r&1&&(i(0,"div",22),n(1),e()),r&2){let t=x();a(),E(" ",t.errorMessage," ")}}function W(r,c){if(r&1&&(i(0,"tr")(1,"td"),n(2),e(),i(3,"td"),n(4),e(),i(5,"td"),n(6),e(),i(7,"td"),n(8),e(),i(9,"td"),n(10),e(),i(11,"td"),n(12),I(13,"date"),e(),i(14,"td"),n(15),e(),i(16,"td")(17,"span",31),n(18),e()()()),r&2){let t=c.$implicit;a(2),p(t.codigo),a(2),p(t.nome_do_posto),a(2),p(t.razao_uso),a(2),p(t.versao_solucao),a(2),p(t.descricao),a(2),p(O(13,9,t.data_limite,"dd/MM/yyyy")),a(3),p(t.responsavel),a(2),d("ngClass",F(12,J,t.status==="APROVADO",t.status==="PENDENTE",t.status==="REPROVADO")),a(),E(" ",t.status," ")}}function X(r,c){if(r&1){let t=y();i(0,"div")(1,"div",23)(2,"p",24),n(3),e(),i(4,"button",25),b("click",function(){C(t);let o=x();return D(o.exportToCSV())}),u(5,"i",26),n(6," Exportar CSV "),e()(),i(7,"div",27)(8,"table",28)(9,"thead",29)(10,"tr")(11,"th"),n(12,"C\xF3digo"),e(),i(13,"th"),n(14,"Posto"),e(),i(15,"th"),n(16,"Raz\xE3o"),e(),i(17,"th"),n(18,"Vers\xE3o"),e(),i(19,"th"),n(20,"Descri\xE7\xE3o"),e(),i(21,"th"),n(22,"Data Limite"),e(),i(23,"th"),n(24,"Respons\xE1vel"),e(),i(25,"th"),n(26,"Status"),e()()(),i(27,"tbody"),S(28,W,19,16,"tr",30),e()()()()}if(r&2){let t=x();a(3),E("Total: ",t.total," equipamentos encontrados"),a(25),d("ngForOf",t.equipamentos)}}function Y(r,c){r&1&&(i(0,"div",32),n(1," Nenhum equipamento encontrado para os filtros aplicados. "),e())}var ae=(()=>{class r{constructor(t,s){this.equipmentsService=t,this.datePipe=s,this.equipamentos=[],this.loading=!1,this.total=0,this.errorMessage=null}ngOnInit(){this.reportForm=new j({status:new g(""),responsavel:new g(""),startDate:new g(""),endDate:new g("")})}generateReport(){this.loading=!0,this.errorMessage=null;let t=this.reportForm.value;this.equipmentsService.listAll().subscribe({next:s=>{let o=s;if(t.status&&(o=o.filter(m=>m.status===t.status)),t.responsavel&&(o=o.filter(m=>m.responsavel?.toLowerCase().includes(t.responsavel.toLowerCase()))),t.startDate&&t.endDate){let m=new Date(t.startDate),v=new Date(t.endDate);o=o.filter(l=>l.data_limite&&new Date(l.data_limite)>=m&&new Date(l.data_limite)<=v)}this.equipamentos=o,this.total=o.length,this.loading=!1},error:s=>{console.error("Erro ao carregar relat\xF3rio:",s),this.errorMessage="Erro ao gerar relat\xF3rio.",this.loading=!1}})}exportToCSV(){let t=this.equipamentos.map(l=>({C\u00F3digo:l.codigo,Posto:l.nome_do_posto,Raz\u00E3o_de_Uso:l.razao_uso,Vers\u00E3o:l.versao_solucao,Descri\u00E7\u00E3o:l.descricao,Respons\u00E1vel:l.responsavel,Status:l.status,Data_Limite:this.datePipe.transform(l.data_limite,"dd/MM/yyyy")})),s=[Object.keys(t[0]).join(";"),...t.map(l=>Object.values(l).join(";"))].join(`
`),o=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(o),v=document.createElement("a");v.href=m,v.download=`relatorio_equipamentos_${Date.now()}.csv`,v.click()}static{this.\u0275fac=function(s){return new(s||r)(_(H),_(f))}}static{this.\u0275cmp=h({type:r,selectors:[["app-reports"]],standalone:!0,features:[w([f]),R],decls:36,vars:5,consts:[[1,"container","mt-4"],[1,"text-primary","fw-bold","mb-4"],[1,"row","g-3","mb-4",3,"ngSubmit","formGroup"],[1,"col-md-3"],["formControlName","status",1,"form-select"],["value",""],["value","PENDENTE"],["value","APROVADO"],["value","REPROVADO"],["formControlName","responsavel","placeholder","Digite o nome",1,"form-control"],[1,"col-md-2"],["type","date","formControlName","startDate",1,"form-control"],["type","date","formControlName","endDate",1,"form-control"],[1,"col-md-2","d-flex","align-items-end"],["type","submit",1,"btn","btn-primary","w-100"],[1,"bi","bi-search"],["class","text-center mt-4",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[4,"ngIf"],["class","alert alert-info text-center mt-4",4,"ngIf"],[1,"text-center","mt-4"],[1,"spinner-border","text-primary"],[1,"alert","alert-danger"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"text-muted"],[1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"bi","bi-filetype-csv"],[1,"table-responsive","shadow-sm","rounded"],[1,"table","table-striped","table-hover","align-middle"],[1,"table-dark"],[4,"ngFor","ngForOf"],[1,"badge",3,"ngClass"],[1,"alert","alert-info","text-center","mt-4"]],template:function(s,o){s&1&&(i(0,"section",0)(1,"h2",1),n(2,"Relat\xF3rios de Equipamentos"),e(),i(3,"form",2),b("ngSubmit",function(){return o.generateReport()}),i(4,"div",3)(5,"label"),n(6,"Status:"),e(),i(7,"select",4)(8,"option",5),n(9,"Todos"),e(),i(10,"option",6),n(11,"Pendente"),e(),i(12,"option",7),n(13,"Aprovado"),e(),i(14,"option",8),n(15,"Reprovado"),e()()(),i(16,"div",3)(17,"label"),n(18,"Respons\xE1vel:"),e(),u(19,"input",9),e(),i(20,"div",10)(21,"label"),n(22,"Data Inicial:"),e(),u(23,"input",11),e(),i(24,"div",10)(25,"label"),n(26,"Data Final:"),e(),u(27,"input",12),e(),i(28,"div",13)(29,"button",14),u(30,"i",15),n(31," Gerar "),e()()(),S(32,K,4,0,"div",16)(33,Q,2,1,"div",17)(34,X,29,2,"div",18)(35,Y,2,0,"div",19),e()),s&2&&(a(3),d("formGroup",o.reportForm),a(29),d("ngIf",o.loading),a(),d("ngIf",o.errorMessage),a(),d("ngIf",!o.loading&&o.equipamentos.length>0),a(),d("ngIf",!o.loading&&o.equipamentos.length===0&&!o.errorMessage))},dependencies:[V,M,N,P,f,$,k,U,B,T,z,q,A,G,L],styles:["form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600}.table[_ngcontent-%COMP%]{border-radius:10px;overflow:hidden}.spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem}"]})}}return r})();export{ae as ReportsComponent};
