import{a as N,c as T,d as A,f as W,h as L,i as j,o as k,p as q,q as D}from"./chunk-SOJED64V.js";import{a as B}from"./chunk-FQ73GNGP.js";import{b as V,d as E}from"./chunk-XU55PKE2.js";import{$a as I,Ab as R,Eb as F,Ha as u,Ja as m,La as s,Ma as n,Na as w,Qa as C,Ra as y,Sa as f,Ta as x,Ua as o,Wa as h,Xa as v,Y as b,Ya as P,Za as _,ea as c,fa as p,ta as r,ua as g}from"./chunk-KKA7MAXA.js";function G(i,M){if(i&1&&(s(0,"div",19),o(1),n()),i&2){let t=f();r(),h(" ",t.errorMessage," ")}}function O(i,M){if(i&1&&(s(0,"div",20),o(1),n()),i&2){let t=f();r(),h(" ",t.successMessage," ")}}function z(i,M){i&1&&w(0,"span",21)}var Z=(()=>{class i{constructor(t,d,e){this.auth=t,this.route=d,this.router=e,this.oldPassword="",this.newPassword="",this.confirmPassword="",this.email="",this.errorMessage=null,this.successMessage=null,this.loading=!1,this.token=null,this.isFirstAccess=!1}ngOnInit(){this.route.queryParams.subscribe(t=>{this.token=t.token||null,this.email=t.email||"",this.isFirstAccess=t.first==="true",this.isFirstAccess&&(this.oldPassword=sessionStorage.getItem("old_password")||"")})}submit(){if(this.isFirstAccess){if(!this.oldPassword){this.errorMessage="Senha anterior n\xE3o encontrada. Fa\xE7a login novamente.";return}this.auth.changePassword(this.oldPassword,this.newPassword).subscribe({next:()=>{sessionStorage.removeItem("old_password"),this.successMessage="Senha alterada com sucesso! Fa\xE7a login novamente.",setTimeout(()=>this.router.navigate(["/login"]),2e3)},error:t=>{console.error("Erro ao alterar senha:",t),this.errorMessage=t.error?.detail||"Erro ao alterar senha."},complete:()=>this.loading=!1})}}static{this.\u0275fac=function(d){return new(d||i)(g(B),g(V),g(E))}}static{this.\u0275cmp=b({type:i,selectors:[["app-reset-password"]],standalone:!0,features:[I],decls:25,vars:6,consts:[["resetForm","ngForm"],[1,"reset-password","container","d-flex","justify-content-center","align-items-center","vh-100"],[1,"card","shadow","p-4",2,"max-width","400px","width","100%"],[1,"text-center","w-100"],["src","/assets/images/logo-painel.png","alt","Logo","height","60"],[1,"text-center","mt-4"],["class","alert alert-danger",4,"ngIf"],["class","alert alert-success",4,"ngIf"],[3,"ngSubmit"],[1,"mb-3"],["for","newPassword",1,"form-label"],["type","password","id","newPassword","name","newPassword","placeholder","Digite sua nova senha","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","name","confirmPassword","placeholder","Repita sua nova senha","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"d-grid"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"mt-3","text-center"],["routerLink","/login",1,"text-decoration-none"],[1,"alert","alert-danger"],[1,"alert","alert-success"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(d,e){if(d&1){let l=C();s(0,"div",1)(1,"div",2)(2,"div",3),w(3,"img",4),s(4,"h2",5),o(5,"Redefina sua Senha:"),n()(),u(6,G,2,1,"div",6)(7,O,2,1,"div",7),s(8,"form",8,0),y("ngSubmit",function(){return c(l),p(e.submit())}),s(10,"div",9)(11,"label",10),o(12,"Nova senha:"),n(),s(13,"input",11),_("ngModelChange",function(a){return c(l),P(e.newPassword,a)||(e.newPassword=a),p(a)}),n()(),s(14,"div",9)(15,"label",12),o(16,"Confirme nova senha:"),n(),s(17,"input",13),_("ngModelChange",function(a){return c(l),P(e.confirmPassword,a)||(e.confirmPassword=a),p(a)}),n()(),s(18,"div",14)(19,"button",15),u(20,z,1,0,"span",16),o(21," Redefinir senha "),n()()(),s(22,"div",17)(23,"a",18),o(24,"Voltar ao login"),n()()()()}if(d&2){let l=x(9);r(6),m("ngIf",e.errorMessage),r(),m("ngIf",e.successMessage),r(6),v("ngModel",e.newPassword),r(4),v("ngModel",e.confirmPassword),r(2),m("disabled",l.invalid||e.loading||e.newPassword!==e.confirmPassword),r(),m("ngIf",e.loading)}},dependencies:[F,R,D,j,N,T,A,k,q,L,W]})}}return i})();export{Z as ResetPasswordComponent};
